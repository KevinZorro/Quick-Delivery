<div class="p-6 max-w-4xl mx-auto">

  <h2 class="text-3xl font-bold text-gray-800 mb-6">üì¶ Historial de pedidos</h2>

  <!-- Cargando -->
  <div *ngIf="cargando" class="flex items-center gap-2 text-purple-600">
    <span class="animate-spin border-2 border-purple-600 border-t-transparent rounded-full w-5 h-5"></span>
    Cargando pedidos...
  </div>

  <!-- Sin pedidos -->
  <div *ngIf="!cargando && pedidos.length === 0"
       class="bg-yellow-100 text-yellow-800 p-4 rounded-lg shadow-sm border-l-4 border-yellow-500 text-center">
    No hay pedidos a√∫n.
  </div>

  <!-- Mensaje -->
  <div *ngIf="mensaje"
       class="bg-green-100 text-green-700 p-3 rounded-xl mb-4 text-center font-medium shadow">
    {{ mensaje }}
  </div>

  <!-- Lista de pedidos -->
  <div *ngFor="let pedido of pedidos"
       class="bg-white mt-6 p-5 rounded-2xl shadow-md border border-gray-200 hover:shadow-lg transition-shadow duration-200">

    <!-- Encabezado -->
    <div class="flex justify-between items-center">
      <h3 class="text-xl font-semibold text-gray-800">
        üßæ Pedido <span class="text-purple-600">#{{ pedido.id.slice(0, 8) }}</span>
      </h3>

      <!-- Estado actual con colores -->
      <span
        class="px-3 py-1 rounded-full text-sm font-semibold border"
        [ngClass]="{
          'bg-yellow-100 text-yellow-800 border-yellow-300': pedido.estado === 'INICIADO',
          'bg-blue-100 text-blue-800 border-blue-300': pedido.estado === 'EN_COCINA',
          'bg-purple-100 text-purple-800 border-purple-300': pedido.estado === 'CON_EL_REPARTIDOR',
          'bg-green-100 text-green-800 border-green-300': pedido.estado === 'ENTREGADO'
        }">
        {{ pedido.estado }}
      </span>
    </div>

    <!-- Informaci√≥n general -->
    <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 text-gray-700 mt-4">

      <div class="p-3 bg-gray-50 rounded-lg border">
        <p class="text-sm text-gray-500">Total</p>
        <p class="text-lg font-bold text-green-600">
          {{ pedido.total | currency:'COP' }}
        </p>
      </div>

      <div class="p-3 bg-gray-50 rounded-lg border">
        <p class="text-sm text-gray-500">Fecha</p>
        <p class="font-medium">
          {{ pedido.fechaCreacion | date:'short' }}
        </p>
      </div>

      <div class="p-3 bg-gray-50 rounded-lg border">
        <p class="text-sm text-gray-500">Productos</p>
        <p class="font-medium">
          {{ pedido.items?.length || 0 }} items
        </p>
      </div>

    </div>

    <!-- Cambiar estado -->
    <div class="mt-5">
      <label class="block text-sm font-medium text-gray-700 mb-2">Cambiar estado:</label>

      <div class="flex gap-3 items-center">
        <select
  aria-label="Cambiar estado del pedido"
  (change)="cambiarEstado(pedido.id, $any($event.target).value)"
  class="border rounded-lg px-3 py-2 bg-gray-50 text-gray-800 shadow-sm"
  [disabled]="cargandoCambio === pedido.id"
>


          <option disabled selected>Selecciona estado...</option>

          <option *ngFor="let estado of estados" [value]="estado">
            {{ estado }}
          </option>
        </select>

        <span *ngIf="cargandoCambio === pedido.id" class="text-sm text-purple-600">
          Actualizando...
        </span>
      </div>
    </div>

    <!-- Items -->
    <div *ngIf="pedido.items" class="mt-6">
      <h4 class="text-lg font-semibold text-gray-800 mb-3">üõçÔ∏è Productos del pedido</h4>

      <div class="space-y-3">
        <div *ngFor="let item of pedido.items"
             class="p-3 bg-gray-100 rounded-xl border flex justify-between items-center">

          <div>
            <p class="font-medium text-gray-800">{{ item.nombre }}</p>
            <p class="text-sm text-gray-600">Cantidad: <strong>{{ item.cantidad }}</strong></p>
          </div>

          <p class="font-semibold text-gray-800">
            {{ item.subtotal | currency:'COP' }}
          </p>

        </div>
      </div>
    </div>

  </div>

</div>
