<div class="menu-container">
  <!-- Header -->
  <header class="header">
    <button class="btn-volver" (click)="volverInicio()">← Volver al Inicio</button>
    <h1>Gestión de Productos</h1>
    <button class="btn-agregar" (click)="abrirModalCrear()">+ Agregar Producto</button>
  </header>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <p>Cargando productos...</p>
  </div>

  <!-- Error -->
  <div *ngIf="errorMessage" class="error-message">
    <p>{{ errorMessage }}</p>
  </div>

  <!-- Contenido Principal -->
  <div *ngIf="!loading && !errorMessage" class="contenido">
    <!-- Filtros -->
    <section class="filtros">
      <h3>Filtrar Productos</h3>
      <div class="filtros-grid">
        <input 
          type="text" 
          placeholder="Buscar por nombre..." 
          [(ngModel)]="busquedaNombre"
          (input)="aplicarFiltros()"
          class="input-filtro">

        <select 
          [(ngModel)]="categoriaFiltro" 
          (change)="aplicarFiltros()"
          class="select-filtro">
          <option value="">Todas las categorías</option>
          <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
        </select>

        <input 
          type="number" 
          placeholder="Precio mínimo" 
          [(ngModel)]="precioMin"
          (input)="aplicarFiltros()"
          class="input-filtro">

        <input 
          type="number" 
          placeholder="Precio máximo" 
          [(ngModel)]="precioMax"
          (input)="aplicarFiltros()"
          class="input-filtro">

        <button class="btn-limpiar" (click)="limpiarFiltros()">Limpiar Filtros</button>
      </div>
    </section>

    <!-- Lista de Productos -->
    <section class="productos">
      <h3>Productos ({{ productosFiltrados.length }})</h3>
      
      <div *ngIf="productosFiltrados.length === 0" class="sin-productos">
        <p>No hay productos disponibles</p>
      </div>

      <div class="productos-grid">
        <div *ngFor="let producto of productosFiltrados" class="producto-card">
          <img [src]="producto.imagenUrl" [alt]="producto.nombre" class="producto-imagen">
          <div class="producto-info">
            <h4>{{ producto.nombre }}</h4>
            <p class="descripcion">{{ producto.descripcion }}</p>
            <p class="categoria">Categoría: <strong>{{ producto.categoria }}</strong></p>
            <p class="precio">${{ producto.precio }}</p>
            <p class="disponible" [class.no-disponible]="!producto.disponible">
              {{ producto.disponible ? '✓ Disponible' : '✗ No disponible' }}
            </p>
          </div>
          <div class="producto-acciones">
            <button class="btn-editar" (click)="abrirModalEditar(producto)">Editar</button>
            <button class="btn-eliminar" (click)="eliminarProducto(producto.id!)">Eliminar</button>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Modal Crear/Editar -->
  <div *ngIf="mostrarModal" class="modal-overlay" (click)="cerrarModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <h2>{{ modoEdicion ? 'Editar Producto' : 'Crear Producto' }}</h2>
      
      <form class="form-producto">
        <label>
          Nombre *
          <input type="text" [(ngModel)]="productoActual.nombre" name="nombre" required>
        </label>

        <label>
          Descripción
          <textarea [(ngModel)]="productoActual.descripcion" name="descripcion" rows="3"></textarea>
        </label>

        <label>
          Precio *
          <input type="number" [(ngModel)]="productoActual.precio" name="precio" min="0" step="0.01" required>
        </label>

        <label>
          Categoría *
          <select [(ngModel)]="productoActual.categoria" name="categoria" required>
            <option value="">Selecciona una categoría</option>
            <option *ngFor="let cat of categorias" [value]="cat">{{ cat }}</option>
          </select>
        </label>

        <label>
          URL de la Imagen
          <input type="text" [(ngModel)]="productoActual.imagenUrl" name="imagenUrl">
        </label>

        <label class="checkbox-label">
          <input type="checkbox" [(ngModel)]="productoActual.disponible" name="disponible">
          Disponible
        </label>

        <div class="modal-acciones">
          <button type="button" class="btn-cancelar" (click)="cerrarModal()">Cancelar</button>
          <button type="button" class="btn-guardar" (click)="guardarProducto()">Guardar</button>
        </div>
      </form>
    </div>
  </div>
</div>
